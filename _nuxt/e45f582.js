(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{299:function(t,e,r){var content=r(438);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(115).default)("2f600f50",content,!0,{sourceMap:!1})},437:function(t,e,r){"use strict";r(299)},438:function(t,e,r){var n=r(114)(!1);n.push([t.i,".content[data-v-85a02490]{display:flex;flex-direction:column}",""]),t.exports=n},441:function(t,e,r){"use strict";r.r(e);r(28),r(39),r(57),r(33),r(58),r(44),r(46),r(48),r(49);var n,o,c,l=r(440),d=r(22),f=r(20),h=r(3),m=(r(25),r(300),r(11),r(26),r(304),r(305),r(306),r(307),r(308),r(309),r(311),r(312),r(313),r(314),r(315),r(316),r(317),r(27),r(29),r(148),r(203),r(318),r(32),r(319),r(320),r(322),r(323),r(324),r(325),r(326),r(327),r(328),r(329),r(330),r(331),r(332),r(333),r(334),r(335),r(336),r(50),r(110),r(40),r(53));!function(t){t.tab="tab",t.bloks="bloks",t.text="text",t.textarea="textarea",t.markdown="markdown",t.number="number",t.datetime="datetime",t.boolean="boolean",t.option="option",t.options="options",t.image="image",t.file="file",t.multiasset="multiasset",t.multilink="multilink",t.section="section",t.richtext="richtext"}(n||(n={})),function(t){t.Document="doc",t.Heading="heading",t.Paragraph="paragraph",t.BulletList="bullet_list",t.NumberList="ordered_list",t.ListItem="list_item",t.Quote="blockquote",t.Code="code_block",t.Text="text",t.HorizontalRule="horizontal_rule",t.HardBreak="hard_break",t.Blok="blok"}(o||(o={})),function(t){t.Bold="bold",t.Italic="italic",t.Underline="underline",t.Strike="strike",t.Link="link"}(c||(c={}));var v,y=r(337),w=r(439);function x(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function S(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function L(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?S(Object(source),!0).forEach((function(e){Object(f.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):S(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}!function(t){t[t.pending=0]="pending",t[t.processing=1]="processing",t[t.success=2]="success",t[t.failed=3]="failed"}(v||(v={}));var O={data:function(){return{showModal:!1,requireRefresh:!1,story:void 0,sourceLanguage:void 0,targetLanguage:void 0,canTranslate:!1,supportedLanguages:[],dsTranslateFields:"Translated Fields",translationRules:new Map,translating:!1,progress:{todo:0,done:0,perc:0}}},mounted:function(){var t=this;return Object(h.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.top==window.self&&window.location.assign("https://app.storyblok.com/oauth/tool_redirect"),window.addEventListener("message",t.processMessage,!1),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"getContext"},"https://app.storyblok.com"),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"heightChange",height:400},"https://app.storyblok.com");case 4:case"end":return e.stop()}}),e)})))()},computed:L({},Object(m.d)("storyblok",["components"])),watch:{sourceLanguage:function(t){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage},targetLanguage:function(t){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage}},methods:L(L(L({},Object(m.c)("storyblok",["loadStoryBlokBridge","readStory","updateStory","readDatasources","readDatasourcEntries","renderRichtext"])),Object(m.c)("deepl",["retrieveSupportedLanguages","translate"])),{},{processMessage:function(t){var e=this;return Object(h.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.data||"get-context"!=t.data.action){r.next=10;break}return e.story=t.data.story,r.next=4,e.retrieveSupportedLanguages();case 4:return e.supportedLanguages=r.sent,e.trySelectDefaultSourceLanguage(),r.next=8,e.retrieveTranslationRules();case 8:e.translationRules=r.sent,e.translationTasks=new Array;case 10:case"end":return r.stop()}}),r)})))()},trySelectDefaultSourceLanguage:function(){var t=this.story.full_slug.split("/",1)[0];if(t){var e=t.split("-").splice(1);if(e.length>0){var r=e[0].toUpperCase(),n=this.supportedLanguages.find((function(t){return t.language===r}));n&&(this.sourceLanguage=n.name)}}},retrieveTranslationRules:function(){var t=this;return Object(h.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l,f,h,m,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,e.next=3,t.readDatasources().then((function(e){return e.find((function(e){return e.name===t.dsTranslateFields}))}));case 3:if(!(n=e.sent)){e.next=10;break}return e.next=7,t.readDatasourcEntries(n.id);case 7:o=e.sent,c=x(o);try{for(c.s();!(l=c.n()).done;)f=l.value,h=f.value.split("."),m=Object(d.a)(h,2),v=m[0],y=m[1],v&&y?(r.has(v)||r.set(v,new Set),r.get(v).add(y)):console.warn("Failed to retrieve translation rule from '".concat(f,"'"))}catch(t){c.e(t)}finally{c.f()}case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))()},shouldTranslate:function(component,t){return!!(this.translationRules.get("*")||new Set).has(t)||!!(this.translationRules.get(component.name)||new Set).has(t)},translateStory:function(){var t=this;return Object(h.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readStory(t.story.id).then((function(e){return t.translating=!0,t.translateStoryContent(e)})).catch((function(t){console.error(t)}));case 2:case"end":return e.stop()}}),e)})))()},translateStoryContent:function(t){var e=this;return Object(h.a)(regeneratorRuntime.mark((function r(){var n,o,c,f,h;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.translateComponent(t.content);case 2:if(n=r.sent,e.progress.todo=n.length,0!=e.progress.todo){r.next=6;break}return r.abrupt("return",t);case 6:return 1,o=Object(l.a)(Array(e.progress.todo).keys()),c=Object(l.a)(Array(Math.ceil(e.progress.todo/1))).map((function(t){return o.splice(0,1)})),r.next=11,Promise.all(c.map((function(t){var r,o=new URLSearchParams({soruce_lang:e.sourceLanguage,target_lang:e.targetLanguage}),c=x(t);try{for(c.s();!(r=c.n()).done;){var l=r.value,f=n[l];if(o.append("text[]",f.target[f.field]||" "),f.extra){var h,m=x(f.extra.entries());try{for(m.s();!(h=m.n()).done;){var y=Object(d.a)(h.value,2),w=y[0],k=y[1];o.append(w,k)}}catch(t){m.e(t)}finally{m.f()}}f.state=v.processing}}catch(t){c.e(t)}finally{c.f()}return e.translate(o).then((function(r){for(var o,i=0;i<t.length;i++){var c=n[t[i]];c.translation=null===(o=r.translations[i])||void 0===o?void 0:o.text,c.state=v.success,e.progress.done++,e.progress.perc=Math.ceil(e.progress.todo/e.progress.done*100)}})).catch((function(e){var r,o=x(t);try{for(o.s();!(r=o.n()).done;){var c=r.value;n[c].state=v.failed}}catch(t){o.e(t)}finally{o.f()}throw e}))}))).catch((function(t){console.error(t)}));case 11:f=x(n);try{for(f.s();!(h=f.n()).done;)h.value.apply()}catch(t){f.e(t)}finally{f.f()}return r.abrupt("return",t);case 14:case"end":return r.stop()}}),r)})))()},translateComponent:function(content){var t=this;return Object(h.a)(regeneratorRuntime.mark((function e(){var r,component,o,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Array,void 0!==(component=t.components.find((function(t){return t.name===content.component})))){e.next=5;break}return console.error("Failed to retrieve component schema for '".concat(content.component,"' type")),e.abrupt("return",r);case 5:o=regeneratorRuntime.mark((function e(){var o,f,h,m,k,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=d[c],(f=component.schema[o])&&(f.type===n.bloks||t.shouldTranslate(component,o))){e.next=4;break}return e.abrupt("return","continue");case 4:h=content[o],e.t0=f.type,e.next=e.t0===n.bloks?8:e.t0===n.text||e.t0===n.textarea?32:e.t0===n.richtext?36:47;break;case 8:m=x(h),e.prev=9,m.s();case 11:if((k=m.n()).done){e.next=23;break}return S=k.value,e.t1=r.push,e.t2=r,e.t3=l.a,e.next=18,t.translateComponent(S);case 18:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t6=e.catch(9),m.e(e.t6);case 28:return e.prev=28,m.f(),e.finish(28);case 31:return e.abrupt("break",48);case 32:if(0!==h.length){e.next=34;break}return e.abrupt("return","continue");case 34:return r.push({target:content,field:o,translation:"",state:v.pending,apply:function(){this.state===v.success&&(content[o]=this.translation)}}),e.abrupt("break",48);case 36:return e.t7=r,e.next=39,t.renderRichtext(h);case 39:return e.t8=e.sent,e.t9={html:e.t8},e.t10=v.pending,e.t11=new URLSearchParams({preserve_formatting:"1",tag_handling:"xml",non_splitting_tags:"a,i,b,strike,span"}),e.t12=function(){if(this.state===v.success){var t=new y.a,e=Object(w.a)(t.turndown(this.translation));content[o]=e}},e.t13={target:e.t9,field:"html",translation:"",state:e.t10,extra:e.t11,apply:e.t12},e.t7.push.call(e.t7,e.t13),e.abrupt("break",48);case 47:return e.abrupt("return","continue");case 48:case"end":return e.stop()}}),e,null,[[9,25,28,31]])})),c=0,d=Object.keys(content);case 7:if(!(c<d.length)){e.next=15;break}return e.delegateYield(o(),"t0",9);case 9:if("continue"!==e.t0){e.next=12;break}return e.abrupt("continue",12);case 12:c++,e.next=7;break;case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e)})))()}})},_=(r(437),r(65)),j=Object(_.a)(O,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.story?r("div",{staticClass:"content"},[t.requireRefresh?r("div",[r("p",{staticStyle:{"text-align":"center"}},[r("SbIcon",{attrs:{name:"caution-pictogram",size:"large"}})],1),t._v(" "),t._m(0)]):r("div",[r("SbModal",{staticStyle:{"padding-left":"10px !important","padding-right":"10px"},attrs:{"is-open":t.showModal},on:{hide:function(e){t.showModal=!1}}},[r("SbModalContent",[r("p",{staticStyle:{"text-align":"center"}},[r("SbIcon",{attrs:{name:"caution-pictogram",size:"x-large"}})],1),t._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("Attention")])]),t._v(" "),r("p",{staticStyle:{"text-align":"justify"}},[t._v("You are about to translate the current story's content from "+t._s(t.sourceLanguage)+" to "+t._s(t.targetLanguage)+". Do you want to proceed?")])]),t._v(" "),r("SbModalFooter",{staticStyle:{"min-height":"40px"}},[r("SbButton",{attrs:{size:"small",label:"Cancel",variant:"ghost"},on:{click:function(e){t.showModal=!1}}}),t._v(" "),r("SbButton",{attrs:{size:"small",label:"Proceed",variant:"primary"},on:{click:function(e){t.showModal=!1,t.translateStory()}}})],1)],1),t._v(" "),t.translating?r("div",[r("SbFormItem",{attrs:{label:"Translation progress"}},[r("SbLoading",{attrs:{type:"bar",showPercentage:""},model:{value:t.progress.perc,callback:function(e){t.$set(t.progress,"perc",e)},expression:"progress.perc"}})],1)],1):r("div",[r("SbFormItem",{attrs:{label:"Source Language"}},[r("SbSelect",{attrs:{options:t.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:t.sourceLanguage,callback:function(e){t.sourceLanguage=e},expression:"sourceLanguage"}})],1),t._v(" "),r("SbFormItem",{attrs:{label:"Target Language"}},[r("SbSelect",{attrs:{options:t.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:t.targetLanguage,callback:function(e){t.targetLanguage=e},expression:"targetLanguage"}})],1),t._v(" "),r("SbButton",{attrs:{"is-full-width":"",isDisabled:!t.canTranslate,icon:"content",label:"Translate",size:"small"},on:{click:function(e){t.showModal=!0}}})],1)],1)]):t._e()}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("Page realod required to display the updated story content type.")])])}],!1,null,"85a02490",null);e.default=j.exports}}]);