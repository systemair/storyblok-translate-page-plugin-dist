(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{298:function(e,t,r){var content=r(437);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(114).default)("9df7dea6",content,!0,{sourceMap:!1})},436:function(e,t,r){"use strict";r(298)},437:function(e,t,r){var n=r(113)(!1);n.push([e.i,".content[data-v-cebe8500]{display:flex;flex-direction:column}",""]),e.exports=n},440:function(e,t,r){"use strict";r.r(t);r(28),r(39),r(57),r(33),r(58),r(44),r(46),r(48),r(49);var n,o,c,l=r(439),d=r(22),f=r(20),h=r(3),m=(r(25),r(299),r(11),r(26),r(303),r(304),r(305),r(306),r(307),r(308),r(310),r(311),r(312),r(313),r(314),r(315),r(316),r(27),r(29),r(147),r(202),r(317),r(32),r(318),r(319),r(321),r(322),r(323),r(324),r(325),r(326),r(327),r(328),r(329),r(330),r(331),r(332),r(333),r(334),r(335),r(50),r(109),r(40),r(53));!function(e){e.tab="tab",e.bloks="bloks",e.text="text",e.textarea="textarea",e.markdown="markdown",e.number="number",e.datetime="datetime",e.boolean="boolean",e.option="option",e.options="options",e.image="image",e.file="file",e.multiasset="multiasset",e.multilink="multilink",e.section="section",e.richtext="richtext"}(n||(n={})),function(e){e.Document="doc",e.Heading="heading",e.Paragraph="paragraph",e.BulletList="bullet_list",e.NumberList="ordered_list",e.ListItem="list_item",e.Quote="blockquote",e.Code="code_block",e.Text="text",e.HorizontalRule="horizontal_rule",e.HardBreak="hard_break"}(o||(o={})),function(e){e.Bold="bold",e.Italic="italic",e.Underline="underline",e.Strike="strike",e.Link="link"}(c||(c={}));var v,y=r(336),w=r(438);function x(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function S(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function L(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?S(Object(source),!0).forEach((function(t){Object(f.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):S(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}!function(e){e[e.pending=0]="pending",e[e.processing=1]="processing",e[e.success=2]="success",e[e.failed=3]="failed"}(v||(v={}));var O={data:function(){return{showModal:!1,requireRefresh:!1,story:void 0,sourceLanguage:void 0,targetLanguage:void 0,canTranslate:!1,supportedLanguages:[],dsTranslateFields:"Translated Fields",translationRules:new Map,translating:!1,progress:{todo:0,done:0,perc:0}}},mounted:function(){var e=this;return Object(h.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:window.top==window.self&&window.location.assign("https://app.storyblok.com/oauth/tool_redirect"),window.addEventListener("message",e.processMessage,!1),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"getContext"},"https://app.storyblok.com"),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"heightChange",height:400},"https://app.storyblok.com");case 4:case"end":return t.stop()}}),t)})))()},computed:L({},Object(m.d)("storyblok",["components"])),watch:{sourceLanguage:function(e){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage},targetLanguage:function(e){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage}},methods:L(L(L({},Object(m.c)("storyblok",["loadStoryBlokBridge","readStory","updateStory","readDatasources","readDatasourcEntries","renderRichtext"])),Object(m.c)("deepl",["retrieveSupportedLanguages","translate"])),{},{processMessage:function(e){var t=this;return Object(h.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.data||"get-context"!=e.data.action){r.next=10;break}return t.story=e.data.story,r.next=4,t.retrieveSupportedLanguages();case 4:return t.supportedLanguages=r.sent,t.trySelectDefaultSourceLanguage(),r.next=8,t.retrieveTranslationRules();case 8:t.translationRules=r.sent,t.translationTasks=new Array;case 10:case"end":return r.stop()}}),r)})))()},trySelectDefaultSourceLanguage:function(){var e=this.story.full_slug.split("/",1)[0];if(e){var t=e.split("-").splice(1);if(t.length>0){var r=t[0].toUpperCase(),n=this.supportedLanguages.find((function(e){return e.language===r}));n&&(this.sourceLanguage=n.name)}}},retrieveTranslationRules:function(){var e=this;return Object(h.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l,f,h,m,v,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Map,t.next=3,e.readDatasources().then((function(t){return t.find((function(t){return t.name===e.dsTranslateFields}))}));case 3:if(!(n=t.sent)){t.next=10;break}return t.next=7,e.readDatasourcEntries(n.id);case 7:o=t.sent,c=x(o);try{for(c.s();!(l=c.n()).done;)f=l.value,h=f.value.split("."),m=Object(d.a)(h,2),v=m[0],y=m[1],v&&y?(r.has(v)||r.set(v,new Set),r.get(v).add(y)):console.warn("Failed to retrieve translation rule from '".concat(f,"'"))}catch(e){c.e(e)}finally{c.f()}case 10:return t.abrupt("return",r);case 11:case"end":return t.stop()}}),t)})))()},shouldTranslate:function(component,e){return!!(this.translationRules.get("*")||new Set).has(e)||!!(this.translationRules.get(component.name)||new Set).has(e)},translateStory:function(){var e=this;return Object(h.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.readStory(e.story.id).then((function(t){return e.translating=!0,e.translateStoryContent(t)})).then((function(t){return e.progress.done>0?e.updateStory(t):t})).then((function(t){e.story=t,e.translating=!1,e.progress.done>0&&(e.requireRefresh=!0,window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"heightChange",height:60},"https://app.storyblok.com")),e.progress.todo=e.progress.done=0})).catch((function(e){console.error(e)}));case 2:case"end":return t.stop()}}),t)})))()},translateStoryContent:function(e){var t=this;return Object(h.a)(regeneratorRuntime.mark((function r(){var n,o,c,f,h;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.translateComponent(e.content);case 2:if(n=r.sent,t.progress.todo=n.length,0!=t.progress.todo){r.next=6;break}return r.abrupt("return",e);case 6:return 10,o=Object(l.a)(Array(t.progress.todo).keys()),c=Object(l.a)(Array(Math.ceil(t.progress.todo/10))).map((function(e){return o.splice(0,10)})),r.next=11,Promise.all(c.map((function(e){var r,o=new URLSearchParams({soruce_lang:t.sourceLanguage,target_lang:t.targetLanguage}),c=x(e);try{for(c.s();!(r=c.n()).done;){var l=r.value,f=n[l];if(o.append("text[]",f.target[f.field]),f.extra){var h,m=x(f.extra.entries());try{for(m.s();!(h=m.n()).done;){var y=Object(d.a)(h.value,2),w=y[0],k=y[1];o.append(w,k)}}catch(e){m.e(e)}finally{m.f()}}f.state=v.processing}}catch(e){c.e(e)}finally{c.f()}return t.translate(o).then((function(r){for(var o,i=0;i<e.length;i++){var c=n[e[i]];c.translation=null===(o=r.translations[i])||void 0===o?void 0:o.text,c.state=v.success,t.progress.done++,t.progress.perc=Math.ceil(t.progress.todo/t.progress.done*100)}})).catch((function(t){var r,o=x(e);try{for(o.s();!(r=o.n()).done;){var c=r.value;n[c].state=v.failed}}catch(e){o.e(e)}finally{o.f()}throw t}))}))).catch((function(e){console.error(e)}));case 11:f=x(n);try{for(f.s();!(h=f.n()).done;)h.value.apply()}catch(e){f.e(e)}finally{f.f()}return r.abrupt("return",e);case 14:case"end":return r.stop()}}),r)})))()},translateComponent:function(content){var e=this;return Object(h.a)(regeneratorRuntime.mark((function t(){var r,component,o,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new Array,void 0!==(component=e.components.find((function(e){return e.name===content.component})))){t.next=5;break}return console.error("Failed to retrieve component schema for '".concat(content.component,"' type")),t.abrupt("return",r);case 5:o=regeneratorRuntime.mark((function t(){var o,f,h,m,k,S;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=d[c],(f=component.schema[o])&&(f.type===n.bloks||e.shouldTranslate(component,o))){t.next=4;break}return t.abrupt("return","continue");case 4:h=content[o],t.t0=f.type,t.next=t.t0===n.bloks?8:t.t0===n.text||t.t0===n.textarea?32:t.t0===n.richtext?36:47;break;case 8:m=x(h),t.prev=9,m.s();case 11:if((k=m.n()).done){t.next=23;break}return S=k.value,t.t1=r.push,t.t2=r,t.t3=l.a,t.next=18,e.translateComponent(S);case 18:t.t4=t.sent,t.t5=(0,t.t3)(t.t4),t.t1.apply.call(t.t1,t.t2,t.t5);case 21:t.next=11;break;case 23:t.next=28;break;case 25:t.prev=25,t.t6=t.catch(9),m.e(t.t6);case 28:return t.prev=28,m.f(),t.finish(28);case 31:return t.abrupt("break",48);case 32:if(0!==h.length){t.next=34;break}return t.abrupt("return","continue");case 34:return r.push({target:content,field:o,translation:"",state:v.pending,apply:function(){this.state===v.success&&(content[o]=this.translation)}}),t.abrupt("break",48);case 36:return t.t7=r,t.next=39,e.renderRichtext(h);case 39:return t.t8=t.sent,t.t9={html:t.t8},t.t10=v.pending,t.t11=new URLSearchParams({preserve_formatting:"1",tag_handling:"xml",non_splitting_tags:"a,i,b,strike,span"}),t.t12=function(){if(this.state===v.success){var e=new y.a,t=Object(w.a)(e.turndown(this.translation));content[o]=t}},t.t13={target:t.t9,field:"html",translation:"",state:t.t10,extra:t.t11,apply:t.t12},t.t7.push.call(t.t7,t.t13),t.abrupt("break",48);case 47:return t.abrupt("return","continue");case 48:case"end":return t.stop()}}),t,null,[[9,25,28,31]])})),c=0,d=Object.keys(content);case 7:if(!(c<d.length)){t.next=15;break}return t.delegateYield(o(),"t0",9);case 9:if("continue"!==t.t0){t.next=12;break}return t.abrupt("continue",12);case 12:c++,t.next=7;break;case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t)})))()}})},_=(r(436),r(65)),j=Object(_.a)(O,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.story?r("div",{staticClass:"content"},[e.requireRefresh?r("div",[r("p",{staticStyle:{"text-align":"center"}},[r("SbIcon",{attrs:{name:"caution-pictogram",size:"large"}})],1),e._v(" "),e._m(0)]):r("div",[r("SbModal",{staticStyle:{"padding-left":"10px !important","padding-right":"10px"},attrs:{"is-open":e.showModal},on:{hide:function(t){e.showModal=!1}}},[r("SbModalContent",[r("p",{staticStyle:{"text-align":"center"}},[r("SbIcon",{attrs:{name:"caution-pictogram",size:"x-large"}})],1),e._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("strong",[e._v("Attention")])]),e._v(" "),r("p",{staticStyle:{"text-align":"justify"}},[e._v("You are about to translate the current story's content from "+e._s(e.sourceLanguage)+" to "+e._s(e.targetLanguage)+". Do you want to proceed?")])]),e._v(" "),r("SbModalFooter",{staticStyle:{"min-height":"40px"}},[r("SbButton",{attrs:{size:"small",label:"Cancel",variant:"ghost"},on:{click:function(t){e.showModal=!1}}}),e._v(" "),r("SbButton",{attrs:{size:"small",label:"Proceed",variant:"primary"},on:{click:function(t){e.showModal=!1,e.translateStory()}}})],1)],1),e._v(" "),e.translating?r("div",[r("SbFormItem",{attrs:{label:"Translation progress"}},[r("SbLoading",{attrs:{type:"bar",showPercentage:""},model:{value:e.progress.perc,callback:function(t){e.$set(e.progress,"perc",t)},expression:"progress.perc"}})],1)],1):r("div",[r("SbFormItem",{attrs:{label:"Source Language"}},[r("SbSelect",{attrs:{options:e.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:e.sourceLanguage,callback:function(t){e.sourceLanguage=t},expression:"sourceLanguage"}})],1),e._v(" "),r("SbFormItem",{attrs:{label:"Target Language"}},[r("SbSelect",{attrs:{options:e.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:e.targetLanguage,callback:function(t){e.targetLanguage=t},expression:"targetLanguage"}})],1),e._v(" "),r("SbButton",{attrs:{"is-full-width":"",isDisabled:!e.canTranslate,icon:"content",label:"Translate",size:"small"},on:{click:function(t){e.showModal=!0}}})],1)],1)]):e._e()}),[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("p",{staticStyle:{"text-align":"center"}},[r("strong",[e._v("Page realod required to display the updated story content type.")])])}],!1,null,"cebe8500",null);t.default=j.exports}}]);