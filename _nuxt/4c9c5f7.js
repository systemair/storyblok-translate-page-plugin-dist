(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{276:function(t,e,r){var content=r(316);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(114).default)("136d37a0",content,!0,{sourceMap:!1})},315:function(t,e,r){"use strict";r(276)},316:function(t,e,r){var n=r(113)(!1);n.push([t.i,".content[data-v-4db6d984]{display:flex;flex-direction:column}",""]),t.exports=n},318:function(t,e,r){"use strict";r.r(e);r(28),r(58),r(33),r(59),r(44),r(46),r(48),r(49);var n,o,c,l,f=r(317),d=r(22),h=r(20),m=r(3),v=(r(25),r(277),r(11),r(26),r(281),r(282),r(283),r(284),r(285),r(286),r(288),r(289),r(290),r(291),r(292),r(293),r(294),r(27),r(29),r(148),r(202),r(295),r(32),r(296),r(297),r(299),r(300),r(301),r(302),r(303),r(304),r(305),r(306),r(307),r(308),r(309),r(310),r(311),r(312),r(313),r(50),r(109),r(39),r(314),r(38),r(53));function y(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function k(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function w(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(e){Object(h.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}!function(t){t.tab="tab",t.bloks="bloks",t.text="text",t.textarea="textarea",t.markdown="markdown",t.number="number",t.datetime="datetime",t.boolean="boolean",t.option="option",t.options="options",t.image="image",t.file="file",t.multiasset="multiasset",t.multilink="multilink",t.section="section",t.richtext="richtext"}(n||(n={})),function(t){t.Document="doc",t.Heading="heading",t.Paragraph="paragraph",t.BulletList="bullet_list",t.NumberList="ordered_list",t.ListItem="list_item",t.Quote="blockquote",t.Code="code_block",t.Text="text",t.HorizontalRule="horizontal_rule",t.HardBreak="hard_break"}(o||(o={})),function(t){t.Bold="bold",t.Italic="italic",t.Underline="underline",t.Strike="strike",t.Link="link"}(c||(c={})),function(t){t[t.pending=0]="pending",t[t.processing=1]="processing",t[t.success=2]="success",t[t.failed=3]="failed"}(l||(l={}));var S={data:function(){return{showModal:!1,requireRefresh:!1,story:void 0,sourceLanguage:void 0,targetLanguage:void 0,canTranslate:!1,supportedLanguages:[],dsTranslateFields:"Translated Fields",translationRules:new Map,translating:!1,progress:{todo:0,done:0,perc:0}}},mounted:function(){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.top==window.self&&window.location.assign("https://app.storyblok.com/oauth/tool_redirect"),window.addEventListener("message",t.processMessage,!1),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"getContext"},"https://app.storyblok.com"),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"heightChange",height:400},"https://app.storyblok.com");case 4:case"end":return e.stop()}}),e)})))()},computed:w({},Object(v.d)("storyblok",["components"])),watch:{sourceLanguage:function(t){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage},targetLanguage:function(t){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage}},methods:w(w(w({},Object(v.c)("storyblok",["loadStoryBlokBridge","readStory","updateStory","readDatasources","readDatasourcEntries"])),Object(v.c)("deepl",["retrieveSupportedLanguages","translate"])),{},{processMessage:function(t){var e=this;return Object(m.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.data||"get-context"!=t.data.action){r.next=10;break}return e.story=t.data.story,r.next=4,e.retrieveSupportedLanguages();case 4:return e.supportedLanguages=r.sent,e.trySelectDefaultSourceLanguage(),r.next=8,e.retrieveTranslationRules();case 8:e.translationRules=r.sent,e.translationTasks=new Array;case 10:case"end":return r.stop()}}),r)})))()},trySelectDefaultSourceLanguage:function(){var t=this.story.full_slug.split("/",1)[0];if(t){var e=t.split("-").splice(1);if(e.length>0){var r=e[0].toUpperCase(),n=this.supportedLanguages.find((function(t){return t.language===r}));n&&(this.sourceLanguage=n.name)}}},retrieveTranslationRules:function(){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l,f,h,m,v,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,e.next=3,t.readDatasources().then((function(e){return e.find((function(e){return e.name===t.dsTranslateFields}))}));case 3:if(!(n=e.sent)){e.next=10;break}return e.next=7,t.readDatasourcEntries(n.id);case 7:o=e.sent,c=y(o);try{for(c.s();!(l=c.n()).done;)f=l.value,h=f.value.split("."),m=Object(d.a)(h,2),v=m[0],x=m[1],v&&x?(r.has(v)||r.set(v,new Set),r.get(v).add(x)):console.warn("Failed to retrieve translation rule from '".concat(f,"'"))}catch(t){c.e(t)}finally{c.f()}case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))()},shouldTranslate:function(component,t){return!!(this.translationRules.get("*")||new Set).has(t)||!!(this.translationRules.get(component.name)||new Set).has(t)},translateStory:function(){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readStory(t.story.id).then((function(e){return t.translating=!0,t.translateStoryContent(e)})).then((function(e){return t.progress.done>0?t.updateStory(e):e})).then((function(e){t.story=e,t.translating=!1,t.progress.done>0&&(t.requireRefresh=!0,window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"heightChange",height:60},"https://app.storyblok.com")),t.progress.todo=t.progress.done=0})).catch((function(t){console.error(t)}));case 2:case"end":return e.stop()}}),e)})))()},translateStoryContent:function(t){var e=this;return Object(m.a)(regeneratorRuntime.mark((function r(){var n,o,c,d,h;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.translateComponent(t.content);case 2:if(n=r.sent,e.progress.todo=n.length,0!=e.progress.todo){r.next=6;break}return r.abrupt("return",t);case 6:return 10,o=Object(f.a)(Array(e.progress.todo).keys()),c=Object(f.a)(Array(Math.ceil(e.progress.todo/10))).map((function(t){return o.splice(0,10)})),r.next=11,Promise.all(c.map((function(t){var r,o=new URLSearchParams({soruce_lang:e.sourceLanguage,target_lang:e.targetLanguage}),c=y(t);try{for(c.s();!(r=c.n()).done;){var f=r.value,d=n[f];o.append("text[]",d.target[d.field]),d.state=l.processing}}catch(t){c.e(t)}finally{c.f()}return e.translate(o).then((function(r){for(var o,i=0;i<t.length;i++){var c=n[t[i]];c.translation=null===(o=r.translations[i])||void 0===o?void 0:o.text,c.state=l.success,e.progress.done++,e.progress.perc=Math.ceil(e.progress.todo/e.progress.done*100)}})).catch((function(e){var r,o=y(t);try{for(o.s();!(r=o.n()).done;){var c=r.value;n[c].state=l.failed}}catch(t){o.e(t)}finally{o.f()}throw e}))}))).catch((function(t){console.error(t)}));case 11:d=y(n);try{for(d.s();!(h=d.n()).done;)h.value.apply()}catch(t){d.e(t)}finally{d.f()}return r.abrupt("return",t);case 14:case"end":return r.stop()}}),r)})))()},translateComponent:function(content){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){var r,component,o,c,d,h,m,v,x,k;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Array,void 0!==(component=t.components.find((function(t){return t.name===content.component})))){e.next=5;break}return console.error("Failed to retrieve component schema for '".concat(content.component,"' type")),e.abrupt("return",r);case 5:o=0,c=Object.keys(content);case 6:if(!(o<c.length)){e.next=50;break}if(d=c[o],(h=component.schema[d])&&(h.type===n.bloks||t.shouldTranslate(component,d))){e.next=11;break}return e.abrupt("continue",47);case 11:m=content[d],e.t0=h.type,e.next=e.t0===n.bloks?15:e.t0===n.text||e.t0===n.textarea?39:e.t0===n.richtext?43:46;break;case 15:v=y(m),e.prev=16,v.s();case 18:if((x=v.n()).done){e.next=30;break}return k=x.value,e.t1=r.push,e.t2=r,e.t3=f.a,e.next=25,t.translateComponent(k);case 25:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 28:e.next=18;break;case 30:e.next=35;break;case 32:e.prev=32,e.t6=e.catch(16),v.e(e.t6);case 35:return e.prev=35,v.f(),e.finish(35);case 38:return e.abrupt("break",47);case 39:if(0!==m.length){e.next=41;break}return e.abrupt("continue",47);case 41:return r.push({target:content,field:d,translation:"",state:l.pending,apply:function(){this.state===l.success&&(this.target[this.field]=this.translation)}}),e.abrupt("break",47);case 43:return content[d]=t.sanitizeRichtext(m),r.push.apply(r,Object(f.a)(t.translateRichtext(content[d]))),e.abrupt("break",47);case 46:return e.abrupt("continue",47);case 47:o++,e.next=6;break;case 50:return e.abrupt("return",r);case 51:case"end":return e.stop()}}),e,null,[[16,32,35,38]])})))()},translateRichtext:function(t){return function t(e){var r=new Array;if(!e)return r;var n,o=y(e.content||[]);try{for(o.s();!(n=o.n()).done;){var c=n.value;r.push.apply(r,Object(f.a)(t(c)))}}catch(t){o.e(t)}finally{o.f()}return e.text&&r.push({target:e,field:"text",translation:"",state:l.pending,apply:function(){this.state===l.success&&(this.target[this.field]=this.translation)}}),r}(t)},sanitizeRichtext:function(t){var e=JSON.parse(JSON.stringify(t));return e=function t(e){if(e){var r,n=[],c=y(e.content||[]);try{for(c.s();!(r=c.n()).done;){var l=t(r.value);l&&n.push(l)}}catch(t){c.e(t)}finally{c.f()}switch(e.content=n,e.type){case o.Paragraph:if(0===e.content.length)return;if(e.content.every((function(t){return t.type===o.HardBreak})))return;if(e.content.every((function(t){return t.type===o.Text}))){var f,d=[],h=y(e.content);try{for(h.s();!(f=h.n()).done;){var text=f.value;text.marks&&(text.marks=text.marks.filter((function(mark){return"link"===mark.type})),text.marks=text.marks.length>0?text.marks:void 0),d.push(text)}}catch(t){h.e(t)}finally{h.f()}e.content=d.reduce((function(t,text){var e=t.at(-1);return e&&void 0===text.marks&&void 0===e.marks?e.text+=text.text:t.push(text),t}),[])}break;case o.ListItem:if(!e.content||0===e.content.length)return}return e}}(e),e}})},L=(r(315),r(65)),O=Object(L.a)(S,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.story?r("div",{staticClass:"content"},[t.requireRefresh?r("div",[r("p",{staticStyle:{"text-align":"center"}},[r("SbIcon",{attrs:{name:"caution-pictogram",size:"large"}})],1),t._v(" "),t._m(0)]):r("div",[r("SbModal",{staticStyle:{"padding-left":"10px !important","padding-right":"10px"},attrs:{"is-open":t.showModal},on:{hide:function(e){t.showModal=!1}}},[r("SbModalContent",[r("p",{staticStyle:{"text-align":"center"}},[r("SbIcon",{attrs:{name:"caution-pictogram",size:"x-large"}})],1),t._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("Attention")])]),t._v(" "),r("p",{staticStyle:{"text-align":"justify"}},[t._v("You are about to translate the current story's content from "+t._s(t.sourceLanguage)+" to "+t._s(t.targetLanguage)+". Do you want to proceed?")])]),t._v(" "),r("SbModalFooter",{staticStyle:{"min-height":"40px"}},[r("SbButton",{attrs:{size:"small",label:"Cancel",variant:"ghost"},on:{click:function(e){t.showModal=!1}}}),t._v(" "),r("SbButton",{attrs:{size:"small",label:"Proceed",variant:"primary"},on:{click:function(e){t.showModal=!1,t.translateStory()}}})],1)],1),t._v(" "),t.translating?r("div",[r("SbFormItem",{attrs:{label:"Translation progress"}},[r("SbLoading",{attrs:{type:"bar",showPercentage:""},model:{value:t.progress.perc,callback:function(e){t.$set(t.progress,"perc",e)},expression:"progress.perc"}})],1)],1):r("div",[r("SbFormItem",{attrs:{label:"Source Language"}},[r("SbSelect",{attrs:{options:t.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:t.sourceLanguage,callback:function(e){t.sourceLanguage=e},expression:"sourceLanguage"}})],1),t._v(" "),r("SbFormItem",{attrs:{label:"Target Language"}},[r("SbSelect",{attrs:{options:t.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:t.targetLanguage,callback:function(e){t.targetLanguage=e},expression:"targetLanguage"}})],1),t._v(" "),r("SbButton",{attrs:{"is-full-width":"",isDisabled:!t.canTranslate,icon:"content",label:"Translate",size:"small"},on:{click:function(e){t.showModal=!0}}})],1)],1)]):t._e()}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("Page realod required to display the updated story content type.")])])}],!1,null,"4db6d984",null);e.default=O.exports}}]);