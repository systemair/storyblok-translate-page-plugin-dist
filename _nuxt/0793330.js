(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{276:function(t,e,n){var content=n(315);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(114).default)("19ebc79e",content,!0,{sourceMap:!1})},314:function(t,e,n){"use strict";n(276)},315:function(t,e,n){var r=n(113)(!1);r.push([t.i,".content[data-v-4f857b6b]{display:flex;flex-direction:column}",""]),t.exports=r},317:function(t,e,n){"use strict";n.r(e);n(28),n(38),n(57),n(33),n(58),n(44),n(46),n(48),n(49);var r,o,c,l,f=n(316),d=n(22),h=n(20),m=n(3),y=(n(25),n(277),n(11),n(26),n(281),n(282),n(283),n(284),n(285),n(286),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(27),n(29),n(147),n(202),n(295),n(32),n(296),n(297),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(50),n(109),n(39),n(56),n(53));function v(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function w(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function k(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?w(Object(source),!0).forEach((function(e){Object(h.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):w(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}!function(t){t.tab="tab",t.bloks="bloks",t.text="text",t.textarea="textarea",t.markdown="markdown",t.number="number",t.datetime="datetime",t.boolean="boolean",t.option="option",t.options="options",t.image="image",t.file="file",t.multiasset="multiasset",t.multilink="multilink",t.section="section",t.richtext="richtext"}(r||(r={})),function(t){t.Document="doc",t.Heading="heading",t.Paragraph="paragraph",t.BulletList="bullet_list",t.NumberList="ordered_list",t.ListItem="list_item",t.Quote="blockquote",t.Code="code_block",t.Text="text",t.HorizontalRule="horizontal_rule",t.HardBreak="hard_break"}(o||(o={})),function(t){t.Bold="bold",t.Italic="italic",t.Underline="underline",t.Strike="strike",t.Link="link"}(c||(c={})),function(t){t[t.pending=0]="pending",t[t.processing=1]="processing",t[t.success=2]="success",t[t.failed=3]="failed"}(l||(l={}));var S={data:function(){return{showModal:!1,requireRefresh:!1,story:void 0,sourceLanguage:void 0,targetLanguage:void 0,canTranslate:!1,supportedLanguages:[],dsTranslateFields:"Translated Fields",translationRules:new Map,translating:!1,progress:{todo:0,done:0,perc:0}}},mounted:function(){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.top==window.self&&window.location.assign("https://app.storyblok.com/oauth/tool_redirect"),window.addEventListener("message",t.processMessage,!1),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"getContext"},"https://app.storyblok.com"),window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"heightChange",height:400},"https://app.storyblok.com");case 4:case"end":return e.stop()}}),e)})))()},computed:k({},Object(y.d)("storyblok",["components"])),watch:{sourceLanguage:function(t){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage},targetLanguage:function(t){this.canTranslate=this.sourceLanguage&&this.targetLanguage&&this.sourceLanguage!==this.targetLanguage}},methods:k(k(k({},Object(y.c)("storyblok",["loadStoryBlokBridge","readStory","updateStory","readDatasources","readDatasourcEntries"])),Object(y.c)("deepl",["retrieveSupportedLanguages","translate"])),{},{processMessage:function(t){var e=this;return Object(m.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.data||"get-context"!=t.data.action){n.next=10;break}return e.story=t.data.story,n.next=4,e.retrieveSupportedLanguages();case 4:return e.supportedLanguages=n.sent,e.trySelectDefaultSourceLanguage(),n.next=8,e.retrieveTranslationRules();case 8:e.translationRules=n.sent,e.translationTasks=new Array;case 10:case"end":return n.stop()}}),n)})))()},trySelectDefaultSourceLanguage:function(){var t=this.story.full_slug.split("/",1)[0];if(t){var e=t.split("-").splice(1);if(e.length>0){var n=e[0].toUpperCase(),r=this.supportedLanguages.find((function(t){return t.language===n}));r&&(this.sourceLanguage=r.name)}}},retrieveTranslationRules:function(){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){var n,r,o,c,l,f,h,m,y,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Map,e.next=3,t.readDatasources().then((function(e){return e.find((function(e){return e.name===t.dsTranslateFields}))}));case 3:if(!(r=e.sent)){e.next=10;break}return e.next=7,t.readDatasourcEntries(r.id);case 7:o=e.sent,c=v(o);try{for(c.s();!(l=c.n()).done;)f=l.value,h=f.value.split("."),m=Object(d.a)(h,2),y=m[0],x=m[1],y&&x?(n.has(y)||n.set(y,new Set),n.get(y).add(x)):console.warn("Failed to retrieve translation rule from '".concat(f,"'"))}catch(t){c.e(t)}finally{c.f()}case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})))()},shouldTranslate:function(component,t){return!!(this.translationRules.get("*")||new Set).has(t)||!!(this.translationRules.get(component.name)||new Set).has(t)},translateStory:function(){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readStory(t.story.id).then((function(e){return t.translating=!0,t.translateStoryContent(e)})).then((function(e){return t.progress.done>0?t.updateStory(e):e})).then((function(e){t.story=e,t.translating=!1,t.progress.done>0&&(t.requireRefresh=!0,window.parent.postMessage({action:"tool-changed",tool:"translate-page",event:"heightChange",height:60},"https://app.storyblok.com")),t.progress.todo=t.progress.done=0})).catch((function(t){console.error(t)}));case 2:case"end":return e.stop()}}),e)})))()},translateStoryContent:function(t){var e=this;return Object(m.a)(regeneratorRuntime.mark((function n(){var r,o,c,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.translateComponent(t.content);case 2:if(r=n.sent,e.progress.todo=r.length,0!=e.progress.todo){n.next=6;break}return n.abrupt("return",t);case 6:return 10,o=Object(f.a)(Array(e.progress.todo).keys()),c=Object(f.a)(Array(Math.ceil(e.progress.todo/10))).map((function(t){return o.splice(0,10)})),n.next=11,Promise.all(c.map((function(t){var n,o=new URLSearchParams({soruce_lang:e.sourceLanguage,target_lang:e.targetLanguage}),c=v(t);try{for(c.s();!(n=c.n()).done;){var f=n.value,d=r[f];o.append("text[]",d.target[d.field]),d.state=l.processing}}catch(t){c.e(t)}finally{c.f()}return e.translate(o).then((function(n){for(var o,i=0;i<t.length;i++){var c=r[t[i]];c.translation=null===(o=n.translations[i])||void 0===o?void 0:o.text,c.state=l.success,e.progress.done++,e.progress.perc=Math.ceil(e.progress.todo/e.progress.done*100)}})).catch((function(e){var n,o=v(t);try{for(o.s();!(n=o.n()).done;){var c=n.value;r[c].state=l.failed}}catch(t){o.e(t)}finally{o.f()}throw e}))}))).catch((function(t){console.error(t)}));case 11:d=v(r);try{for(d.s();!(h=d.n()).done;)h.value.apply()}catch(t){d.e(t)}finally{d.f()}return n.abrupt("return",t);case 14:case"end":return n.stop()}}),n)})))()},translateComponent:function(content){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){var n,component,o,c,d,h,m,y,x,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Array,void 0!==(component=t.components.find((function(t){return t.name===content.component})))){e.next=5;break}return console.error("Failed to retrieve component schema for '".concat(content.component,"' type")),e.abrupt("return",n);case 5:o=0,c=Object.keys(content);case 6:if(!(o<c.length)){e.next=50;break}if(d=c[o],(h=component.schema[d])&&(h.type===r.bloks||t.shouldTranslate(component,d))){e.next=11;break}return e.abrupt("continue",47);case 11:m=content[d],e.t0=h.type,e.next=e.t0===r.bloks?15:e.t0===r.text||e.t0===r.textarea?39:e.t0===r.richtext?43:46;break;case 15:y=v(m),e.prev=16,y.s();case 18:if((x=y.n()).done){e.next=30;break}return w=x.value,e.t1=n.push,e.t2=n,e.t3=f.a,e.next=25,t.translateComponent(w);case 25:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 28:e.next=18;break;case 30:e.next=35;break;case 32:e.prev=32,e.t6=e.catch(16),y.e(e.t6);case 35:return e.prev=35,y.f(),e.finish(35);case 38:return e.abrupt("break",47);case 39:if(0!==m.length){e.next=41;break}return e.abrupt("continue",47);case 41:return n.push({target:content,field:d,translation:"",state:l.pending,apply:function(){this.state===l.success&&(this.target[this.field]=this.translation)}}),e.abrupt("break",47);case 43:return content[d]=t.sanitizeRichtext(m),n.push.apply(n,Object(f.a)(t.translateRichtext(content[d]))),e.abrupt("break",47);case 46:return e.abrupt("continue",47);case 47:o++,e.next=6;break;case 50:return e.abrupt("return",n);case 51:case"end":return e.stop()}}),e,null,[[16,32,35,38]])})))()},translateRichtext:function(t){return function t(e){var n=new Array;if(!e)return n;var r,o=v(e.content||[]);try{for(o.s();!(r=o.n()).done;){var c=r.value;n.push.apply(n,Object(f.a)(t(c)))}}catch(t){o.e(t)}finally{o.f()}return e.text&&n.push({target:e,field:"text",translation:"",state:l.pending,apply:function(){this.state===l.success&&(this.target[this.field]=this.translation)}}),n}(t)},sanitizeRichtext:function(t){var e=JSON.parse(JSON.stringify(t)),n=[];if(e=function t(e){if(e){var r,c=[],l=v(e.content||[]);try{for(l.s();!(r=l.n()).done;){var f=t(r.value);f&&c.push(f)}}catch(t){l.e(t)}finally{l.f()}switch(e.content=c,e.type){case o.Paragraph:if(0===e.content.length)return;if(e.content.every((function(t){return t.type===o.HardBreak})))return;e.content.every((function(t){return t.type===o.Text}))&&(e.content=[{type:o.Text,text:e.content.reduce((function(t,e){return t+e.text}),"")}]);break;case o.Text:if(e.marks&&e.marks.find((function(mark){return"link"===mark.type})))return void n.push(e);break;case o.ListItem:if(!e.content||0===e.content.length)return}return e}}(e),n.length>0){var r=n.reduce((function(t,link){return[].concat(Object(f.a)(t),[link,{type:o.HardBreak}])}),[]);e.content.push({type:o.Paragraph,content:r})}return e}})},L=(n(314),n(65)),O=Object(L.a)(S,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.story?n("div",{staticClass:"content"},[t.requireRefresh?n("div",[n("p",{staticStyle:{"text-align":"center"}},[n("SbIcon",{attrs:{name:"caution-pictogram",size:"large"}})],1),t._v(" "),t._m(0)]):n("div",[n("SbModal",{staticStyle:{"padding-left":"10px !important","padding-right":"10px"},attrs:{"is-open":t.showModal},on:{hide:function(e){t.showModal=!1}}},[n("SbModalContent",[n("p",{staticStyle:{"text-align":"center"}},[n("SbIcon",{attrs:{name:"caution-pictogram",size:"x-large"}})],1),t._v(" "),n("p",{staticStyle:{"text-align":"center"}},[n("strong",[t._v("Attention")])]),t._v(" "),n("p",{staticStyle:{"text-align":"justify"}},[t._v("You are about to translate the current story's content from "+t._s(t.sourceLanguage)+" to "+t._s(t.targetLanguage)+". Do you want to proceed?")])]),t._v(" "),n("SbModalFooter",{staticStyle:{"min-height":"40px"}},[n("SbButton",{attrs:{size:"small",label:"Cancel",variant:"ghost"},on:{click:function(e){t.showModal=!1}}}),t._v(" "),n("SbButton",{attrs:{size:"small",label:"Proceed",variant:"primary"},on:{click:function(e){t.showModal=!1,t.translateStory()}}})],1)],1),t._v(" "),t.translating?n("div",[n("SbFormItem",{attrs:{label:"Translation progress"}},[n("SbLoading",{attrs:{type:"bar",showPercentage:""},model:{value:t.progress.perc,callback:function(e){t.$set(t.progress,"perc",e)},expression:"progress.perc"}})],1)],1):n("div",[n("SbFormItem",{attrs:{label:"Source Language"}},[n("SbSelect",{attrs:{options:t.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:t.sourceLanguage,callback:function(e){t.sourceLanguage=e},expression:"sourceLanguage"}})],1),t._v(" "),n("SbFormItem",{attrs:{label:"Target Language"}},[n("SbSelect",{attrs:{options:t.supportedLanguages,label:"","item-label":"name","item-value":"language",filterable:""},model:{value:t.targetLanguage,callback:function(e){t.targetLanguage=e},expression:"targetLanguage"}})],1),t._v(" "),n("SbButton",{attrs:{"is-full-width":"",isDisabled:!t.canTranslate,icon:"content",label:"Translate",size:"small"},on:{click:function(e){t.showModal=!0}}})],1)],1)]):t._e()}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",{staticStyle:{"text-align":"center"}},[n("strong",[t._v("Page realod required to display the updated story content type.")])])}],!1,null,"4f857b6b",null);e.default=O.exports}}]);